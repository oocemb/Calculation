{% extends 'base.html' %}

{% block title%} {{calc.title}} {{calc.id}} {% endblock %}

{% block main %}
    {% comment %} Форма добавления новой детали {% endcomment %}
    <div class="row mb-4">
        <h5 class="col-lg-5">Добавить новую деталь (cm!!!)</h5>
        <label class="col-lg-4 text-right">Значание по умолчанию м2: </label>
        <input class="col-lg-2" type="number" id="m2-default" onkeyup="copyValueTo(this, 'm2')" value="1600">
    </div>
    <form action="{% url 'adding_detail' %}" id="form-adding-details"> {%csrf_token%}
    <div class="form-group">
            <label>Высота: </label>
            <input type="number" id="heigth" required class="form-inline">

            <label>Ширина: </label>
            <input type="number" id="width" required class="form-inline">

            <label>Кол-во: </label>
            <input type="number" id="nmb" required class="form-inline">

            <label>Цена м2: </label>
            <input type="number" id="m2" required class="form-inline">
    </div>
            <button role="button" class="btn btn-primary mt-3" id="add_detail_to_calc"
            data-calc_id="{{calc.id}}" type="submit">Добавить</button>
    </form>

    {% comment %} Таблица деталей к конкретному расчёту {% endcomment %}
    <table class="table caption-top table-hover">
    <caption>{{calc.title}}</caption>
    <thead class="table-secondary">
        <tr>
        <th scope="col">Высота</th>
        <th scope="col">Ширина</th>
        <th scope="col">Кол-во</th>
        <th scope="col">Цена м2</th>
        <th scope="col" class="text-center">Стоимость</th>
        <th scope="col"></th>
        </tr>
    </thead>
    <tbody class="body-table-details-in-calc">

    {% comment %} Ajax работа с списком деталей {% endcomment %}
    </tbody>
    <tfoot id="footer-table-details">
    {% comment %} Ajax итого {% endcomment %}
    </tfoot>
    </table>
    <h2 class="mt-4 mb-4">Список фурнитуры</h2>
    <form action="{% url 'adding_furniture' %}" id="form-adding-furniture"> {%csrf_token%}
    </form>
    <div class="accordion" id="accordionExample">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            Сушки
        </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
        <div class="accordion-body">
            <select class="js-select2" name="city" placeholder="Выберите город">
                <option value=""></option>
                <option value="367">Абаза</option>
                <option value="340">Абакан</option>	
                <option value="369">Абдулино</option>	
                <option value="370">Абинск</option>	
                <option value="371">Агидель</option>	
            </select>
            
            <script>
            $(document).ready(function() {
                $('.js-select2').select2({
                    placeholder: "Выберите город",
                    maximumSelectionLength: 2,
                    language: "ru"
                });
            });
            </script>
        </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingTwo">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            Мойки
        </button>
        </h2>
        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
            <div class="accordion-body">
            <select class="form-select-furniture">
            {% for furniture in furniture_list %}
                <option class="furniture" data-id="{{furniture.id}}">{{ furniture.title|truncatechars:80 }} - {{ furniture.article }} -
                {{ furniture.price }} - {{ furniture.availability }} </option>
            {% endfor %}
            </select>
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingThree">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
            Столешницы
        </button>
        </h2>
        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
            <div class="accordion-body">
            <select class="form-select-furniture" size="10" aria-label="select example">
            {% for furniture in furniture_list %}
                <option class="furniture" data-id="{{furniture.id}}">{{ furniture.title|truncatechars:80 }} - {{ furniture.article }} -
                {{ furniture.price }} - {{ furniture.availability }} </option>
            {% endfor %}
            </select>
            </div>
        </div>
    </div>
    </div>



    {% comment %} Таблица деталей к конкретному расчёту {% endcomment %}
    <table class="table caption-top table-hover mt-4 mb-4">
    <caption>{{calc.title}}</caption>
    <thead class="table-secondary">
        <tr>
        <th scope="col">Название</th>
        <th scope="col">Артикул</th>
        <th scope="col">Наличие</th>
        <th scope="col">Цена</th>
        <th scope="col">Кол-во</th>
        <th scope="col" class="text-center">Стоимость</th>
        <th scope="col"></th>
        </tr>
    </thead>
    <tbody class="body-table-furniture-in-calc">
    {% comment %} Ajax работа с списком фурнитуры {% endcomment %}
    </tbody>
    <tfoot id="footer-table-furniture">
    {% comment %} Ajax итого {% endcomment %}
    </tfoot>
    </table>

    

    {% if latest_comment %}
        {% for c in latest_comment %}
            <p>
                <strong>{{c.author_name}}</strong>
                <p>{{c.comment_text}}</p>
            </p>
        {% endfor %}
    {%else%}
        коменты не найдены
    {% endif %}
    <hr>

    <form action="{% url 'comment' calc_id %}" method="POST">
        {%csrf_token%}
        <input type="text" required placeholder="Your name" name="name"><br>
        <textarea name="text" required="" placeholder="Text comment" cols="30" rows="10">
        </textarea><br>
        <button type="submit">Comment now</button>
    </form>
{% endblock %}
